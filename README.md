# Інструкція з налаштування AS5600 як аналогового потенціометра

Цей документ пояснює, як налаштувати енкодер AS5600 для роботи в режимі аналогового потенціометра з вихідним сигналом 0–360°. Ми також включаємо кроки для програмування нульової позиції (ZPOS), встановлення максимального кута (MANG) і збереження налаштувань у постійній пам'яті (OTP).

---

## Підготовка

### Необхідні компоненти
- AS5600 енкодер.
- Arduino Nano або сумісна плата.
- Магніт (діаметрально намагнічений).
- Дюпонт-кабелі підключення.
- Програмне забезпечення Arduino IDE.

---

## Підключення

З'єднайте компоненти наступним чином:

| Пін AS5600 | Пін Arduino Nano |
|------------|------------------|
| VCC        | 5V або 3.3V     |
| GND        | GND             |
| SDA        | A4              |
| SCL        | A5              |

---

## Налаштування

### 1. Перевірка магніту
Переконайтеся, що магніт правильно розташований над AS5600:
- Використовуйте магнітну плівку для перевірки діаметральної намагніченості.
- Розмістіть магніт по центру енкодера на висоті 0.5–3 мм.

У коді перевірте наявність магніту:
```cpp
if (!encoder.detectMagnet()) {
    Serial.println("Магніт не виявлено! Відрегулюйте положення.");
    while (1); // Зупинка виконання
}
Serial.println("Магніт виявлено.");
```
### 2. Налаштування нульової позиції (ZPOS)
- Обертайте магніт до бажаної нульової позиції.
- Використовуйте код для програмування ZPOS:

```cpp
uint16_t rawAngle = encoder.rawAngle(); // Отримання поточного кута
encoder.setZPosition(rawAngle); // Програмування нульової позиції
Serial.println("Нульова позиція запрограмована.");
```
### 3. Встановлення максимального кута (MANG)

- Встановіть максимальний кут для 360° (повний оберт):

```cpp
uint16_t mangValue = (360 * 4096) / 360; // Масштабування кута до одиниць AS5600
encoder.setMaxAngle(mangValue); // Програмування максимального кута
Serial.println("Максимальний кут встановлено на 360°.");
```
### 4. Конфігурація аналогового виходу

- Активуйте режим аналогового виходу:

```cpp
encoder.setOutputMode(0); // 0: Повний діапазон аналогового виходу
Serial.println("Режим аналогового виходу налаштовано.");
```
### 5. Збереження налаштувань (OTP)

- Для збереження ZPOS, MANG і CONF у пам'яті OTP використовуйте:

```cpp
#define AS5600_BURN 0xFF

// Функція для запису в реєстр
bool writeRegister(uint8_t reg, uint8_t value) {
    Wire.beginTransmission(encoder.getAddress());
    Wire.write(reg);
    Wire.write(value);
    return (Wire.endTransmission() == 0);
} 
// Збереження налаштувань
writeRegister(AS5600_BURN, 0x80); // Збереження ZPOS і MANG
writeRegister(AS5600_BURN, 0x40); // Збереження CONF

> **Увага:** Збереження у OTP є незворотним. ZPOS і MANG можна записати до 3 разів, а CONF — лише 1 раз.
```

### Тестування

1. Відкрийте Serial Monitor в Arduino IDE (швидкість: 9600).
2. Перевірте повідомлення про успішне програмування та збереження.
3. Обертайте магніт і перевірте вихідний сигнал (пін OUT):
   - 0° → Близько 0V.
   - 360° → Близько VDD (3.3V або 5V).

## Поширені помилки

### Магніт не виявлено:
- Перевірте висоту й центрування магніту.
- Перевірте, чи є магніт діаметрально намагніченим.

### Налаштування не зберігаються:
- Використовуйте правильні команди OTP збереження.
- Переконайтеся, що ліміт записів OTP не вичерпано.

[Репозиторій бібліотеки яка використовувалась для налаштування](https://github.com/DanOvsyanka/AS5600)

[Документація енкодера](https://github.com/DanOvsyanka/AS5600Configure/blob/main/AS5600.PDF)
